.PHONY: clean check

################################################
# Configuration.  You may want to modify any of these configuration
# variables.
#

#
# This project requires ocamlfind (default - false).
#
USE_OCAMLFIND = true
#
OCAMLPACKS[] =
    oUnit
    extlib


if $(not $(OCAMLFIND_EXISTS))
   eprintln('This project requires ocamlfind, but is was not found.')
   eprintln('You need to install ocamlfind and run "omake --configure".')
   exit 1

#
# Include path
#
OCAMLINCLUDES += ../src/

#
# Compile native or byte code?
#
# The default values are defined as follows:
#
NATIVE_ENABLED = $(OCAMLOPT_EXISTS)
BYTE_ENABLED = true

#
# Various options
#

OCAMLPPFLAGS +=
OCAMLDEPFLAGS += $(OCAMLPPFLAGS)

################################################
# Build an OCaml program
#

FILES[] =
	testtbl
	util
	astUtil
	abcTest
	asmTest
	astTest
	baseTest
	bindcheckTest
	bytesTest
	clostransTest
	closuretransTest
	codegenClassTest
	codegenExprTest
	codegenStmtTest
	cpoolTest
	hListTest
	interCodeTest
	lexerTest
	lispTest
	moduleTest
	nodeTest
	psetTest
	sexpTest
	tupleTest
	varResolveTest


OCAMLINCLUDES += ../../base/
OCAML_LIBS += ../../base/base

PROGRAM = runner
OCAML_LIBS += ../src/habc-scm

OCAML_OTHER_LIBS +=

OCamlProgram($(PROGRAM), $(FILES))

#############################################################
#
# PHONY Target
#
.DEFAULT: check

check: $(PROGRAM)$(EXE)
	./$(PROGRAM)$(EXE) | ounit-postproc

clean:
	ocaml-clean $(PROGRAM)
