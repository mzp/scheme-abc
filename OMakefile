PREFIX:=/usr/local

static. =
	OCAMLFLAGS = -g -annot

Shell. +=
    ounit-postproc(argv) =
      (grep -i "FAIL\|ERROR" && exit 1) || exit 0
    ocaml-clean(argv) =
      rm -f *.cm[iox] *.o *.omc *.opt *.run *~ $(argv) *.cmxa *.a


.PHONY: clean all
.SUBDIRS: scm xml driver base

habc-scm: scm/src/habc-scm
	cp $^ .

habc-xml: xml/src/habc-xml
	cp $^ .

habc : driver/habc
	cp $^ .

PROGRAM = habc habc-xml habc-scm

clean:
	ocaml-clean *.abc $(PROGRAM)

install: $(PROGRAM) share
	mkdir -p $(PREFIX)/bin
	mkdir -p $(PREFIX)/share/habc/
	cp -rfv $(PROGRAM) $(PREFIX)/bin
	cp -rfv share/habc/* $(PREFIX)/share/habc/

all: $(PROGRAM)

.DEFAULT: all
