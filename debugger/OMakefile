# build
OCAMLPACKS[] =
	extlib
	oUnit
	unix
	threads

OCAMLFLAGS+=-thread

FILES[] =
	main
	socket
	packet
	serialize
	writer
	outMsg

UseCamlp4(pa_openin pa_oo pa_field pa_monad)
PROGRAM=dbg-test

OCAMLINCLUDES += $(ROOT)/base
OCAML_LIBS    += $(ROOT)/base/base

OCAMLOPT   = ocamlopt -for-pack $(capitalize $(basename $(PROGRAM)))
OCAMLOPTLINK= ocamlopt

.DEFAULT: $(OCamlProgram $(PROGRAM), $(FILES))

# test
OUnitTest(socket, socket)
OUnitTest(packet, packet)
OUnitTest(writer, writer)
OUnitTest(parsec, parsec)
OUnitTest(serialize, serialize writer)
OUnitTest(outMsg, outMsg serialize writer)

# phony
.PHONY: clean

clean:
    ocaml-clean
